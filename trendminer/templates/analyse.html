{% extends "base.html" %}

{% block content %}

  <div class="page-header">
    <h1>
      TrendMiner Showcase <small>Upload your data (.zip or .xml format)...</small>
    </h1>
  </div>

  <form class="form-horizontal" enctype="multipart/form-data" method="post" action="{% url trendminer.views.analyse %}">
    {% csrf_token %}
    <fieldset class="form-horizontal">

      {% if message %}
	{% if message == "Success!" %}
	  <div class="control-group success">
	{% else %}
	  <div class="control-group error">
	{% endif %}
	    <label class="control-label" for="{{form.data.auto_id}}">
	      {{form.data.label}}
	    </label>
	    <div class="controls">
	      {{form.data}}
	      <span class="help-inline">{{ message }}</span>
	    </div>
	  </div>
      {% else %}
	<div class="control-group">
	  <label class="control-label" for="{{form.data.auto_id}}">
	    {{form.data.label}}
	  </label>
	  <div class="controls">
	    {{form.data}}
	    <span class="help-inline"></span>
	  </div>
	</div>
      {% endif %}

      <div class="form-actions">
	<button type="submit" class="btn btn-primary">Upload</button>
      </div>
    </fieldset>
  </form>

  {% if entities %}
    <fieldset>
      <legend>Your Results</legend>
      <table class="table table-striped table-hover">
	<thead>
	  <th>Name</th>
	  <th>Source Title</th>
	  <th>Ticker String</th>
	  <th>Polarity</th>
	</thead>
	<tbody>
	  {% for entity in entities %}
	    <tr>
              {% for attribute in entity.attributes %}
              <td>
		{% if attribute %}
		  {{ attribute }}
		{% else %}
		  -
		{% endif %}
              </td>
              {% endfor %}
              <td style="white-space: nowrap">
                {% for i in entity.polarity %}
                  <i class="icon-star"></i>
                {% endfor %}
              </td>
	    </tr>
	  {% endfor %}
	</tbody>
      </table>

      <div class="pagination pagination-centered">
        <ul>
          {% for page_number in page_range %}
            {% if page_number == entities.number %}
              <li class="active"><a href="{% url results rid page_number %}">{{ page_number }}</a></li>
            {% else %}
              <li><a href="{% url results rid page_number %}">{{ page_number }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>

    </fieldset>
  {% endif %}

{% endblock %}

{% block javascript %}
  <script type="text/javascript">
    $(document).ready(function() {
      $('div.controls input:first').bind('change', function() {
        var fileSize = this.files[0].size;
        if (fileSize > 5242880) {
          if ($('div.control-group').hasClass('info')) {
            $('div.control-group').removeClass('info');
          }
          $('span.help-inline').text('File is too large. The current limit is ' + {{ max_upload_size }} + 'MB.');
          $('div.control-group').addClass('error');
          $('button.btn').attr('disabled', 'disabled');
        }
        else {
          if ($('div.control-group').hasClass('error')) {
            $('div.control-group').removeClass('error');
          }
          $('span.help-inline').text('File size is within limits.');
          $('div.control-group').addClass('info');
          $('button.btn').removeAttr('disabled');
        }
      });
    });
  </script>
{% endblock %}
